---
title: "ICILS2023_proc"
format: html
editor: visual
---

# Procesamiento para ICILS 2023

El presente documento tiene como objetivo realizar los procesamientos necesarios para unir las bases de datos de estudiantes de todos los países del 2023.

#### Cargamos paquetes

```{r}
library(pacman)
p_load(dplyr)
options(scipen = 999) 
rm(list = ls())      
```

#### Cargamos las bases de datos

```{r}

# Obtener la lista de archivos que comienzan con "BSG" y terminan con ".Rdata"
archivos_bsg <- list.files(
  path = "./ICILS2023_IDB_R/Data", # Directorio actual (cambia si es necesario)
  pattern = "^BSG.*\\.Rdata$",
  full.names = TRUE
)

# Ver qué archivos encontramos
print(archivos_bsg)

# Cargar todos los archivos encontrados
for (archivo in archivos_bsg) {
  load(archivo)
  cat("Cargado:", archivo, "\n")
}

```

#### Unimos todos los dataframes de estudiantes

```{r}

# Primero, asegúrate de tener dplyr
library(dplyr)

# Lista todos los objetos que son data frames en tu entorno
todos_los_objetos <- ls()
dataframes_bsg <- list()

# Filtra solo los data frames que comienzan con BSG
for (nombre_objeto in todos_los_objetos) {
  objeto <- get(nombre_objeto)
  # Verifica si es un data frame y si el nombre comienza con BSG
  if (is.data.frame(objeto) && grepl("^BSG", nombre_objeto)) {
    dataframes_bsg[[nombre_objeto]] <- objeto
  }
}

# Ahora combina todos los data frames usando bind_rows
datos_combinados <- bind_rows(dataframes_bsg)

library(haven)

# Procesar datos iniciales
datos_combinados$CNTRY <- haven::zap_labels(datos_combinados$CNTRY)

# Ver el resultado
dim(datos_combinados)  # Dimensiones del data frame combinado
```

#### 
